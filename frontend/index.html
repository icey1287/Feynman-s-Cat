<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>费曼的猫 🐱 - 让用户教AI</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 - 历史会话 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>📚 历史会话</h3>
                <button class="new-session-btn" onclick="createNewSession()">+ 新建</button>
            </div>
            <div class="session-list" id="sessionList">
                <!-- 会话列表会在这里动态添加 -->
            </div>
            <div class="sidebar-footer">
                <button class="sidebar-btn" onclick="openStats()">📊 统计</button>
                <button class="sidebar-btn" onclick="openAchievements()">🏆 成就</button>
            </div>
        </aside>

        <!-- 主内容区 -->
        <div class="main-content">
            <div class="container">
                <!-- 头部区域 -->
                <header class="header">
                    <div class="header-left">
                        <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                    </div>
                    <div class="header-center">
                        <h1>🐱 费曼的猫</h1>
                        <p class="subtitle">最好的学习方式是教别人</p>
                    </div>
                    <div class="header-right">
                        <button class="settings-btn" onclick="openSettings()">⚙️</button>
                    </div>
                </header>

                <!-- 猫咪状态区域 -->
                <div class="cat-container">
                    <div class="cat-avatar" id="catAvatar">
                        <span class="cat-emoji" id="catEmoji">😺</span>
                        <div class="cat-animation-overlay" id="catAnimationOverlay"></div>
                    </div>
                    <div class="cat-info">
                        <p class="cat-name" id="catName">小费曼</p>
                        <p class="cat-status" id="catStatus">等待学习新知识...</p>
                        <p class="cat-catchphrase" id="catCatchphrase"></p>
                    </div>
                </div>

                <!-- 知识条区域 -->
                <div class="knowledge-bar-container">
                    <div class="knowledge-label">
                        <span>知识掌握度</span>
                        <span class="progress-text" id="progressText">0/100 (让我们开始吧！)</span>
                    </div>
                    <div class="knowledge-bar">
                        <div class="knowledge-fill" id="knowledgeFill" style="width: 0%"></div>
                        <div class="knowledge-sparkle" id="knowledgeSparkle"></div>
                    </div>
                    <div class="knowledge-states">
                        <span class="state confused">一头雾水</span>
                        <span class="state learning">一知半解</span>
                        <span class="state mastered">完全掌握</span>
                    </div>
                    <div class="gain-feedback" id="gainFeedback" style="display: none;"></div>
                </div>

                <!-- 当前话题 -->
                <div class="current-topic" id="currentTopic" style="display: none;">
                    <span class="topic-label">当前学习：</span>
                    <span class="topic-name" id="topicName"></span>
                    <button class="reset-btn" onclick="resetSession()">🔄 换个话题</button>
                </div>

                <!-- 开始学习表单 -->
                <div class="start-form" id="startForm">
                    <h2>📚 选择一个知识点</h2>
                    <p>输入你想要教给<span id="catNameInForm">小费曼</span>的知识点</p>
                    <div class="input-group">
                        <input type="text" id="topicInput" placeholder="例如：二叉树、光合作用、相对论..." 
                               onkeypress="handleTopicKeyPress(event)">
                        <button class="start-btn" onclick="startLearning()">开始教学 🎓</button>
                    </div>
                    <div class="examples">
                        <span>热门话题：</span>
                        <button onclick="setTopic('递归算法')">递归算法</button>
                        <button onclick="setTopic('光合作用')">光合作用</button>
                        <button onclick="setTopic('供需曲线')">供需曲线</button>
                        <button onclick="setTopic('牛顿第三定律')">牛顿第三定律</button>
                    </div>
                </div>

                <!-- 对话区域 -->
                <div class="chat-container" id="chatContainer" style="display: none;">
                    <div class="chat-messages" id="chatMessages">
                        <!-- 消息会在这里动态添加 -->
                    </div>
                    <div class="chat-input-container">
                        <textarea id="messageInput" placeholder="用你自己的话解释给猫咪听..." 
                                  onkeypress="handleMessageKeyPress(event)" rows="3"></textarea>
                        <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                            发送 📨
                        </button>
                    </div>
                    <div class="hint-box" id="hintBox" style="display: none;">
                        <span class="hint-icon">💡</span>
                        <span class="hint-text" id="hintText"></span>
                    </div>
                </div>

                <!-- 加载弹窗 -->
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-cat" id="loadingCat">🐱</div>
                        <div class="loading-text" id="loadingText">猫咪正在思考...</div>
                        <div class="loading-bar">
                            <div class="loading-progress" id="loadingProgress"></div>
                        </div>
                        <div class="loading-tips" id="loadingTips">正在连接AI服务...</div>
                    </div>
                </div>

                <!-- 通关庆祝 -->
                <div class="celebration" id="celebration" style="display: none;">
                    <div class="celebration-content">
                        <h2>🎉 恭喜通关！</h2>
                        <p class="celebration-emoji">😸</p>
                        <p><span id="catNameInCelebration">小费曼</span>完全理解了 "<span id="completedTopic"></span>"</p>
                        <p class="celebration-message">你是一位优秀的老师！</p>
                        <button class="new-topic-btn" onclick="resetSession()">挑战新知识点 🚀</button>
                    </div>
                </div>

                <!-- 底部说明 -->
                <footer class="footer">
                    <p>💡 费曼学习法：如果你不能简单地解释一件事，说明你还没有真正理解它。</p>
                </footer>
            </div>
        </div>
    </div>

    <!-- 设置弹窗 -->
    <div class="settings-overlay" id="settingsOverlay" style="display: none;">
        <div class="settings-content">
            <h2>⚙️ 设置</h2>
            <div class="settings-form">
                <div class="setting-item">
                    <label for="catNameInput">猫咪昵称</label>
                    <input type="text" id="catNameInput" placeholder="给你的猫咪起个名字" maxlength="10">
                </div>
                <p class="setting-hint">猫咪会用这个名字自称哦～</p>
                
                <div class="setting-item">
                    <label for="gradeSelect">我的年级</label>
                    <select id="gradeSelect">
                        <option value="default">百科全书模式</option>
                        <option value="primary_1_3">小学1-3年级</option>
                        <option value="primary_4_6">小学4-6年级</option>
                        <option value="middle_school">初中</option>
                        <option value="high_school">高中</option>
                        <option value="university">大学及以上</option>
                    </select>
                </div>
                <p class="setting-hint">根据年级调整AI的回答风格</p>
                
                <div class="setting-item">
                    <label for="subjectSelect">常学学科</label>
                    <select id="subjectSelect">
                        <option value="all">百科全书（所有学科）</option>
                        <option value="math">数学</option>
                        <option value="physics">物理</option>
                        <option value="chemistry">化学</option>
                        <option value="biology">生物</option>
                        <option value="history">历史</option>
                        <option value="geography">地理</option>
                        <option value="chinese">语文</option>
                        <option value="english">英语</option>
                        <option value="programming">编程/计算机</option>
                        <option value="art">艺术</option>
                        <option value="music">音乐</option>
                        <option value="philosophy">哲学</option>
                        <option value="economics">经济学</option>
                        <option value="psychology">心理学</option>
                    </select>
                </div>
                <p class="setting-hint">选择你主要学习的学科领域</p>
            </div>
            <div class="settings-actions">
                <button class="settings-cancel" onclick="closeSettings()">取消</button>
                <button class="settings-save" onclick="saveSettings()">保存</button>
            </div>
        </div>
    </div>

    <!-- 首次设置弹窗 -->
    <div class="welcome-overlay" id="welcomeOverlay" style="display: none;">
        <div class="welcome-content">
            <h2>🐱 欢迎来到费曼的猫！</h2>
            <p class="welcome-desc">这里有一只需要你来教的AI小猫咪</p>
            <div class="welcome-cat">😺</div>
            <div class="welcome-form">
                <label>给你的猫咪起个名字吧：</label>
                <input type="text" id="welcomeCatName" placeholder="例如：奶茶、煤球、小橘..." maxlength="10">
                
                <label style="margin-top: 15px;">你是哪个年级的呢？</label>
                <select id="welcomeGrade">
                    <option value="default">跳过（百科全书模式）</option>
                    <option value="primary_1_3">小学1-3年级</option>
                    <option value="primary_4_6">小学4-6年级</option>
                    <option value="middle_school">初中</option>
                    <option value="high_school">高中</option>
                    <option value="university">大学及以上</option>
                </select>
                
                <label style="margin-top: 15px;">你主要想学什么呢？</label>
                <select id="welcomeSubject">
                    <option value="all">百科全书（所有学科）</option>
                    <option value="math">数学</option>
                    <option value="physics">物理</option>
                    <option value="chemistry">化学</option>
                    <option value="biology">生物</option>
                    <option value="history">历史</option>
                    <option value="programming">编程/计算机</option>
                </select>
            </div>
            <button class="welcome-btn" onclick="completeWelcome()">开始使用 🚀</button>
        </div>
    </div>

    <!-- 成就弹窗 -->
    <div class="achievements-overlay" id="achievementsOverlay" style="display: none;">
        <div class="achievements-content">
            <div class="achievements-header">
                <h2>🏆 我的成就</h2>
                <button class="close-btn" onclick="closeAchievements()">✕</button>
            </div>
            <div class="achievements-summary" id="achievementsSummary">
                <span class="unlocked-count">已解锁: <b id="unlockedCount">0</b></span>
                <span class="total-count">/ <span id="totalCount">0</span></span>
            </div>
            <div class="achievements-list" id="achievementsList">
                <!-- 成就列表动态生成 -->
            </div>
        </div>
    </div>

    <!-- 统计弹窗 -->
    <div class="stats-overlay" id="statsOverlay" style="display: none;">
        <div class="stats-content">
            <div class="stats-header">
                <h2>📊 学习统计</h2>
                <button class="close-btn" onclick="closeStats()">✕</button>
            </div>
            
            <!-- 日期导航（类似苹果屏幕使用时间） -->
            <div class="stats-date-nav">
                <button class="date-nav-btn" onclick="navigateStatsDate(-1)">‹</button>
                <div class="date-nav-display">
                    <span class="date-nav-label" id="statsDateLabel">今天</span>
                    <span class="date-nav-date" id="statsDateValue"></span>
                </div>
                <button class="date-nav-btn" onclick="navigateStatsDate(1)" id="statsNextBtn">›</button>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card clickable" onclick="showStatDetail('topics')">
                    <div class="stat-icon">📚</div>
                    <div class="stat-value" id="statTopicsCompleted">0</div>
                    <div class="stat-label">完成话题</div>
                    <div class="stat-arrow">›</div>
                </div>
                <div class="stat-card clickable" onclick="showStatDetail('knowledge')">
                    <div class="stat-icon">💡</div>
                    <div class="stat-value" id="statTotalKnowledge">0</div>
                    <div class="stat-label">累计知识点</div>
                    <div class="stat-arrow">›</div>
                </div>
                <div class="stat-card clickable" onclick="showStatDetail('messages')">
                    <div class="stat-icon">💬</div>
                    <div class="stat-value" id="statTotalMessages">0</div>
                    <div class="stat-label">教学消息</div>
                    <div class="stat-arrow">›</div>
                </div>
                <div class="stat-card clickable" onclick="showStatDetail('streak')">
                    <div class="stat-icon">🔥</div>
                    <div class="stat-value" id="statCurrentStreak">0</div>
                    <div class="stat-label">连续天数</div>
                    <div class="stat-arrow">›</div>
                </div>
            </div>
            
            <div class="stats-chart-section">
                <div class="chart-header">
                    <h3>📈 知识增长趋势</h3>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-dot knowledge"></span>知识点</span>
                        <span class="legend-item"><span class="legend-dot messages"></span>消息数</span>
                    </div>
                </div>
                <div class="line-chart-container" id="lineChartContainer">
                    <svg class="line-chart" id="lineChart" viewBox="0 0 500 200"></svg>
                    <div class="chart-x-labels" id="chartXLabels"></div>
                </div>
            </div>
            
            <div class="stats-subjects-section">
                <h3>🎯 学科分布</h3>
                <div class="subjects-loading" id="subjectsLoading" style="display: none;">
                    <span>🔄 AI正在分析学科分布...</span>
                </div>
                <div class="subjects-chart" id="subjectsChart">
                    <!-- 学科分布动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 统计详情弹窗 -->
    <div class="stat-detail-overlay" id="statDetailOverlay" style="display: none;">
        <div class="stat-detail-content">
            <div class="stat-detail-header">
                <button class="back-btn" onclick="closeStatDetail()">‹ 返回</button>
                <h3 id="statDetailTitle">详情</h3>
            </div>
            <div class="stat-detail-summary" id="statDetailSummary">
                <!-- 摘要信息 -->
            </div>
            <div class="stat-detail-list" id="statDetailList">
                <!-- 详情列表 -->
            </div>
        </div>
    </div>

    <!-- 成就解锁通知 -->
    <div class="achievement-notification" id="achievementNotification" style="display: none;">
        <div class="achievement-notification-content">
            <div class="achievement-icon" id="achievementNotificationIcon">🏆</div>
            <div class="achievement-info">
                <div class="achievement-title">成就解锁！</div>
                <div class="achievement-name" id="achievementNotificationName"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
